<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        
        <link rel="stylesheet" href="reset.css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        
        <!-- Google AdSense -->
        <script data-ad-client="ca-pub-1177915241290016" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script data-ad-client="ca-pub-1177915241290016" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>    <link rel="stylesheet" href="style.css" type="text/css">
        
        <link rel="shortcut icon" href="files/images/favicon.png" type="image/png">
        <script src="script.js" defer></script>
        
        <title>Granpa Mining | Home</title>
    </head>
<body>

    <div class="header">
        <img class="GMLogo" src="files/images/2019 logo transparent.png" alt="GPM Logo">
        <h1 class="GMLogoText">Granpa Mining</h1>
    
        <img id="navIcon" src="files/images/mobileMenu.png" alt="Navigation Menu" style="display: none;">

            <div class="navElements">
                <p class="navSelected">Home</p>
                <div class="navDiv"></div>
                <p><a href="Projects/Projects.html">Projects</a></p>
                <a href="Payments/Crunchyroll.html"><p class="open-payments">Payments</p></a>
            </div>
    </div>
    
<div class="body2">
    <div id="newsA" class="newscontainer">
        <!-- Retrieved through Firebase -->
        <h2 class="title">News</h2>
        <div class="container loading">
            <p>Loading...</p>
            <h6 class="postdate">Loading...</h6>
        </div>
    </div>

    <div class="platform-container">
        <h2 class="title">More</h2>
        <div class="platform-card">
            <h2>Discord</h2> <!-- Don't move -->
                <p>Join our Discord Server</p>
                <a href="https://discord.gg/m6B2EXu"><div class="join-discord">Join</div></a>
        </div>
        <div class="discordVC-count" style="display: none;"><span id="VC-count">0</span> Users in Voice Chat</div>
        <div class="platform-card">
            <h2>Reddit</h2> <!-- Don't move -->
                <p>Check our subreddit!</p>
                <a href="https://www.reddit.com/r/GrandpaMining/"><div class="open-reddit">Join</div></a>
        </div>
        <div class="platform-card">
            <h2>Watch2Gether</h2> <!-- Don't move -->
                <p>Join our W2G room!</p>
                <a href="https://www.watch2gether.com/rooms/grandpamining-xe2g2esl3nd0vrq62y?lang=en"><div class="join-w2g">Join</div></a>
        </div>
        <div class="platform-card">
            <h2>Warning Database</h2> <!-- Don't move -->
                <p>Check for warnings</p>
                <a href="https://www.notion.so/fc68b34f307e4180b8d389283c237ea9?v=2d7f608e00ef4b21a8dd67d8e9caeaf0"><div class="open-notion">Open</div></a>
        </div>
    </div>

    <div id="eventsA" class="calendar-container">
        <!-- Retrieved through Firebase -->
        <h2 class="title">Events</h2>
        <h3 class="date">Loading...</h3>
        <div class="calendarContainer">
            <ul>
                <li>Loading...</li>
            </ul>
        </div>
</div>
<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>

<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-database.js"></script>

<script>
// TODO: Replace the following with your app's Firebase project configuration
var firebaseConfig = {
    apiKey: "AIzaSyAhPz-IG85lj7AIPvrPvxV0-RnLNaU888A",
    authDomain: "project-id.firebaseapp.com",
    databaseURL: "https://grandpa-mining-website.firebaseio.com/",
    projectId: "project-id",
    storageBucket: "project-id.appspot.com",
    messagingSenderId: "sender-id",
    appId: "app-id",
    measurementId: "G-measurement-id",
};
  
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

retrieveData()
function retrieveData() {
    firebase.database().ref('/news/').once('value').then(function(snapshot){
        let newsArray = snapshot.val()
        console.log(newsArray)
    
        let loadingElement = document.getElementById('newsA')
        while (loadingElement.firstChild){
            loadingElement.removeChild(loadingElement.firstChild)
        }
    
        newsArray.forEach(element => {
            const listElement = document.createElement('div')
            const listText = document.createElement('p')
            const listDate = document.createElement('h6')
            
            listText.innerText = element.title
            listDate.innerText = element.date
            listElement.appendChild(listText)
            listElement.appendChild(listDate)
            listElement.setAttribute('class', 'container')
            listDate.setAttribute('class', 'postdate')
            document.getElementById('newsA').prepend(listElement)
        });
    
        const listDate = document.createElement('h2')
        listDate.innerText='News'
        document.getElementById('newsA').prepend(listDate)
    })
    
    firebase.database().ref('/events/').once('value').then(function(snapshot){
        let eventsArray = snapshot.val()
        console.log(eventsArray)
    
        let loadingElement = document.getElementById('eventsA')
        while (loadingElement.firstChild){
            loadingElement.removeChild(loadingElement.firstChild)
        }
    
        eventsArray.forEach(element => {
            const listElement = document.createElement('div')
            const listDescContainer = document.createElement('ul')
            const listDesc = document.createElement('li')
            const listDiv = document.createElement('div')
            const listDate = document.createElement('h3')
            
            listDate.innerText = element.date
            listDesc.innerText = element.description
            listElement.appendChild(listDate)
            listDiv.appendChild(listDescContainer)
            listDescContainer.appendChild(listDesc)
            listElement.appendChild(listDiv)
            listDate.setAttribute('class', 'date')
            listDiv.setAttribute('class', 'calendarContainer')
            document.getElementById('eventsA').appendChild(listElement)
        });
    
        const listDate = document.createElement('h2')
        listDate.innerText='Events'
        listDate.setAttribute('class', 'title')
        document.getElementById('eventsA').prepend(listDate)
        
        document.getElementsByClassName('newscontainer')[0].style.webkitAnimationPlayState = "running";
        document.getElementsByClassName('platform-container')[0].style.webkitAnimationPlayState = "running";
        document.getElementsByClassName('calendar-container')[0].style.webkitAnimationPlayState = "running";
    })

    firebase.database().ref('/voiceActivity/').once('value').then(function(snapshot){
        let users = snapshot.val()
        console.log(users)
        setcount(users)
    })
}

function addEvent(id, desc, date) {
    firebase.database().ref('events/' + id).set({
        description: desc,
        date: date
    });
}
function addNews(id, title, date) {
    firebase.database().ref('news/' + id).set({
        title: title,
        date: date
    });
}

function setcount(number) {
    if(number === 0){
        document.getElementsByClassName('discordVC-count')[0].style.display='none'
        document.getElementsByClassName('discordVC-count')[0].style.webkitAnimationPlayState = "paused";
    } else {
        document.getElementsByClassName('discordVC-count')[0].style.display='block'
        document.getElementsByClassName('discordVC-count')[0].style.webkitAnimationPlayState = "running";
        document.getElementById('VC-count').innerText=number
    }
}

setInterval(() => {
    retrieveData()
}, 60000);
</script>
</body>
</html>